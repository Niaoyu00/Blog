<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>unity平台跳跃控制器(持续更新) - Niaoyu</title><link rel="manifest" href="/Blog/manifest.json"><meta name="application-name" content="Niaoyu"><meta name="msapplication-TileImage" content="/img/Bird.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Niaoyu"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="教程来自b站阿严:https:&amp;#x2F;&amp;#x2F;www.bilibili.com&amp;#x2F;video&amp;#x2F;BV1rL4y1W7KH 一 项目的创建和管理插件 删除不需要的插件，安装需要的插件，删除后插件内容：  1.1 安装： Cinemachine，虚拟相机插件。 Post Processing，后处理插件。 Input System，新的输入系统插件。  1.2 安装完成后图: 1.3 导入资源包这里我使用的是自己在u"><meta property="og:type" content="article"><meta property="og:title" content="unity平台跳跃控制器(持续更新)"><meta property="og:url" content="https://niaoyu00.github.io/Blog/2022/07/08/unity%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8/"><meta property="og:site_name" content="Niaoyu"><meta property="og:description" content="教程来自b站阿严:https:&amp;#x2F;&amp;#x2F;www.bilibili.com&amp;#x2F;video&amp;#x2F;BV1rL4y1W7KH 一 项目的创建和管理插件 删除不需要的插件，安装需要的插件，删除后插件内容：  1.1 安装： Cinemachine，虚拟相机插件。 Post Processing，后处理插件。 Input System，新的输入系统插件。  1.2 安装完成后图: 1.3 导入资源包这里我使用的是自己在u"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151216150.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151839520.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708152529919.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162106523.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172046551.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172412575.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708193345419.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153516317.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153636233.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153742399.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715154429486.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715155527938.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161313196.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161513401.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162041929.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719030021036.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162722895.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715163129842.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719042545564.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220720175109099.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722155719378.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722160205417.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162430682.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162634092.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163045286.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163504217.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163532695.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163837612.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729025838477.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729034552855.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729035245706.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803155755085.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803170504220.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803182643175.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804124847239.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125015412.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125321555.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804131918252.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132030035.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132047150.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135546469.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135713005.png"><meta property="og:image" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804140201463.png"><meta property="article:published_time" content="2022-07-08T06:59:54.828Z"><meta property="article:modified_time" content="2022-10-02T19:50:00.395Z"><meta property="article:author" content="ZHY"><meta property="article:tag" content="unity"><meta property="article:tag" content="平台跳跃控制器"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151216150.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://niaoyu00.github.io/Blog/2022/07/08/unity%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8/"},"headline":"unity平台跳跃控制器(持续更新)","image":["https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151216150.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151839520.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708152529919.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162106523.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172046551.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172412575.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708193345419.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153516317.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153636233.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153742399.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715154429486.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715155527938.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161313196.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161513401.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162041929.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719030021036.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162722895.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715163129842.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719042545564.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220720175109099.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722155719378.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722160205417.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162430682.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162634092.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163045286.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163504217.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163532695.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163837612.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729025838477.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729034552855.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729035245706.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803155755085.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803170504220.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803182643175.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804124847239.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125015412.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125321555.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804131918252.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132030035.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132047150.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135546469.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135713005.png","https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804140201463.png"],"datePublished":"2022-07-08T06:59:54.828Z","dateModified":"2022-10-02T19:50:00.395Z","author":{"@type":"Person","name":"ZHY"},"publisher":{"@type":"Organization","name":"Niaoyu","logo":{"@type":"ImageObject","url":"https://niaoyu00.github.io/img/Bird.png"}},"description":"教程来自b站阿严:https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1rL4y1W7KH 一 项目的创建和管理插件 删除不需要的插件，安装需要的插件，删除后插件内容：  1.1 安装： Cinemachine，虚拟相机插件。 Post Processing，后处理插件。 Input System，新的输入系统插件。  1.2 安装完成后图: 1.3 导入资源包这里我使用的是自己在u"}</script><link rel="canonical" href="https://niaoyu00.github.io/Blog/2022/07/08/unity%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8/"><link rel="icon" href="/Blog/img/Bird.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/Blog/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/Blog/"><img src="/Blog/img/Bird.png" alt="Niaoyu" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/Blog/">首页</a><a class="navbar-item" href="/Blog/archives">时间线</a><a class="navbar-item" href="/Blog/categories">分类</a><a class="navbar-item" href="/Blog/tags">标签</a><a class="navbar-item" href="/Blog/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="我的 GitHub" href="https://github.com/Niaoyu00"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-07-08T06:59:54.828Z" title="2022/7/8 14:59:54">2022-07-08</time>发表</span><span class="level-item"><time dateTime="2022-10-02T19:50:00.395Z" title="2022/10/3 03:50:00">2022-10-03</time>更新</span><span class="level-item"><a class="link-muted" href="/Blog/categories/unity/">unity</a></span><span class="level-item">33 分钟读完 (大约4958个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">unity平台跳跃控制器(持续更新)</h1><div class="content"><h4 id="教程来自b站阿严-https-www-bilibili-com-video-BV1rL4y1W7KH"><a href="#教程来自b站阿严-https-www-bilibili-com-video-BV1rL4y1W7KH" class="headerlink" title="教程来自b站阿严:https://www.bilibili.com/video/BV1rL4y1W7KH"></a>教程来自b站阿严:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1rL4y1W7KH">https://www.bilibili.com/video/BV1rL4y1W7KH</a></h4><hr>
<h2 id="一-项目的创建和管理插件"><a href="#一-项目的创建和管理插件" class="headerlink" title="一 项目的创建和管理插件"></a>一 项目的创建和管理插件</h2><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151216150.png" alt="image-20220708151216150"></p>
<p>删除不需要的插件，安装需要的插件，删除后插件内容：</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151839520.png" alt="image-20220708151839520"></p>
<h3 id="1-1-安装："><a href="#1-1-安装：" class="headerlink" title="1.1 安装："></a>1.1 安装：</h3><ul>
<li>Cinemachine，虚拟相机插件。</li>
<li>Post Processing，后处理插件。</li>
<li>Input System，新的输入系统插件。</li>
</ul>
<h3 id="1-2-安装完成后图"><a href="#1-2-安装完成后图" class="headerlink" title="1.2 安装完成后图:"></a>1.2 安装完成后图:</h3><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708152529919.png" alt="image-20220708152529919"></p>
<h3 id="1-3-导入资源包"><a href="#1-3-导入资源包" class="headerlink" title="1.3 导入资源包"></a>1.3 导入资源包</h3><p>这里我使用的是自己在unity商店买的资源包，替换了unity酱，想要做点不一样的。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162106523.png" alt="image-20220727162106523"></p>
<hr>
<h2 id="二-状态机系统"><a href="#二-状态机系统" class="headerlink" title="二 状态机系统"></a>二 状态机系统</h2><p>创建接口文件和状态机类</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172046551.png" alt="image-20220708172046551"></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172412575.png" alt="image-20220708172412575"></p>
<h3 id="2-1-Istate接口"><a href="#2-1-Istate接口" class="headerlink" title="2.1 Istate接口"></a>2.1 Istate接口</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IState</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Enter</span>()</span>;<span class="comment">//状态进入</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Exit</span>()</span>;<span class="comment">//状态退出</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span>;<span class="comment">//状态逻辑更新</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span>;<span class="comment">//状态物理更新</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-StateMachine类"><a href="#2-2-StateMachine类" class="headerlink" title="2.2 StateMachine类"></a>2.2 StateMachine类</h3><p>作用:</p>
<ul>
<li>持有所有状态,并且进行管理和切换;</li>
<li>负责当前状态的更新.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StateMachine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//1、持有所有状态,并且进行管理和切换;2、负责当前状态的更新</span></span><br><span class="line">  IState currentState;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新状态逻辑</span></span><br><span class="line">    currentState.LogicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新物理</span></span><br><span class="line">    currentState.PhysicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SwitchOn</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//状态开启</span></span><br><span class="line">   <span class="comment">//新状态赋值给当前状态,然后启动</span></span><br><span class="line">    currentState = newState;</span><br><span class="line">    currentState.Enter();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//切换状态</span></span><br><span class="line">   <span class="comment">//先关闭状态,然后新状态赋值给当前状态,启动</span></span><br><span class="line">    currentState.Exit();</span><br><span class="line">    SwitchOn(newState);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三-扩展状态机系统"><a href="#三-扩展状态机系统" class="headerlink" title="三 扩展状态机系统"></a>三 扩展状态机系统</h2><p><strong>创建PlayerStates(玩家状态)并初始化</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span> : <span class="title">ScriptableObject</span>, <span class="title">IState</span></span><br><span class="line">&#123;<span class="comment">//玩家状态类</span></span><br><span class="line">  Animator animator;<span class="comment">//动画器</span></span><br><span class="line">  PlayerStateMachine stateMachine;<span class="comment">//玩家状态机类</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">Animator animator, PlayerStateMachine stateMachine</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">this</span>.animator = animator;</span><br><span class="line">    <span class="keyword">this</span>.stateMachine = stateMachine;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>PlayerStatesMachine(玩家状态机)</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-状态机系统继承关系图"><a href="#3-1-状态机系统继承关系图" class="headerlink" title="3.1 状态机系统继承关系图"></a>3.1 状态机系统继承关系图</h3><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708193345419.png" alt="image-20220708193345419"></p>
<h3 id="3-2-使用两种方法实现角色动画"><a href="#3-2-使用两种方法实现角色动画" class="headerlink" title="3.2 使用两种方法实现角色动画"></a>3.2 使用两种方法实现角色动画</h3><h4 id="3-2-1、常规方法-不使用状态机"><a href="#3-2-1、常规方法-不使用状态机" class="headerlink" title="3.2.1、常规方法(不使用状态机)"></a>3.2.1、常规方法(不使用状态机)</h4><p><strong>构建基础状态机系统,创建动画控制器</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153516317.png" alt="image-20220715153516317"></p>
<p><strong>拖到玩家对象</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153636233.png" alt="image-20220715153636233"></p>
<p><strong>将动画拖入控制器</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153742399.png" alt="image-20220715153742399"></p>
<p><strong>更改默认状态</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715154429486.png" alt="image-20220715154429486"></p>
<p><strong>然后在player对象添加玩家控制器脚本</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715155527938.png" alt="image-20220715155527938"></p>
<p><strong>需求分析:</strong></p>
<ul>
<li>按下A&#x2F;D键时播放跑步动画</li>
<li>松开按键回到空闲动画</li>
</ul>
<p><strong>实现方式：</strong></p>
<ul>
<li>获取键盘的输入信号(Input System)</li>
<li>播放特定动画(Animator)</li>
</ul>
<p><strong>PlayerController代码如下：</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();<span class="comment">//获取动画控制组件</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//按住当前键盘的a或者d键</span></span><br><span class="line">    <span class="comment">//if(Input.GetKey(KeyCode.A)|| Input.GetKey(KeyCode.D))</span></span><br><span class="line">    <span class="keyword">if</span> (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">      animator.Play(<span class="string">&quot;Run&quot;</span>);<span class="comment">//播放动画器中特定动画</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">//松开按键时</span></span><br><span class="line">    &#123;</span><br><span class="line">      animator.Play(<span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>并且同时更改动画器中动画的名字，以匹配代码中的命名</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161313196.png" alt="image-20220715161313196"></p>
<p><strong>全部改完效果如图：</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161513401.png" alt="image-20220715161513401"></p>
<h4 id="3-2-2、通过状态机实现动画状态切换"><a href="#3-2-2、通过状态机实现动画状态切换" class="headerlink" title="3.2.2、通过状态机实现动画状态切换"></a>3.2.2、通过状态机实现动画状态切换</h4><p><strong>首先将状态机脚本添加到玩家上</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162041929.png" alt="image-20220715162041929"></p>
<p><strong>其次在Player State文件夹中创建idle和run状态脚本</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719030021036.png" alt="image-20220719030021036"></p>
<p>皆继承于PlayerState</p>
<p><code>[CreateAssetMenu(menuName = &quot;Data/StateMachine/PlayerState/Idle&quot;, fileName = &quot;PlayerState_Idle&quot;)]</code></p>
<p>这条代码将代码暴露在编辑器中，可在文件夹中创建可程序化对象文件</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162722895.png" alt="image-20220715162722895"></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715163129842.png" alt="image-20220715163129842"></p>
<p><strong>举例PlayerState_Idle代码如下:</strong></p>
<p><strong>重写状态函数,更新状态</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Idle&quot;</span>, fileName = <span class="string">&quot;PlayerState_Idle&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Idle</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">      stateMachine.SwitchState(stateMachine.runState);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>PlayerState_Idle脚本代码同理。</strong></p>
<p><strong>状态机模式将不同状态分开来处理,这个模式中只需要思考,当前状态如何切换到下一状态,而不再需要同时考虑另一个状态的逻辑问题。</strong></p>
<p><strong>(例如需要落地后才可起跳，常规方法需要使用很多Boolean值来判断状态，而状态机模式只需要在各自状态中实现切换即可)</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719042545564.png" alt="image-20220719042545564"></p>
<h3 id="3-3-状态机模式优缺点"><a href="#3-3-状态机模式优缺点" class="headerlink" title="3.3 状态机模式优缺点"></a>3.3 状态机模式优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>逻辑分开到各个状态中处理，不需要考虑状态之间的约束，让思路更清楚。</li>
<li>代码性能提升</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>文件数量增加</li>
<li>代码重复</li>
</ul>
<h3 id="3-4-继续完善状态机功能"><a href="#3-4-继续完善状态机功能" class="headerlink" title="3.4 继续完善状态机功能"></a>3.4 继续完善状态机功能</h3><p><strong>打开玩家状态机脚本PlayerStateMachine</strong></p>
<p>目前所有新状态都需要新建初始化,是否可以声明一个鸡和然后将所有状态都扔进去呢?当然可以。</p>
<p><strong>首先修改玩家状态机类的代码，(注释中是原代码)</strong></p>
<p>我们新建一个states数组，通过遍历获取玩家具体状态。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="comment">//public PlayerState_Idle idleState;</span></span><br><span class="line">  <span class="comment">//public PlayerState_Run runState;</span></span><br><span class="line">    </span><br><span class="line">  [<span class="meta">SerializeField</span>] PlayerState[] states;<span class="comment">//持有所有状态</span></span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(animator, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    SwitchOn(【idleState】);<span class="comment">//默认idle，【idleState】报错，需要通过字典</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么做<code>idleState</code>会出现报错，</p>
<p>这时需要在<strong>父类创建字典</strong>，声明一个<strong>键为System.Type值为IState类型</strong>的字典</p>
<p>然后在玩家状态机类PlayerStateMachine中的状态遍历循环中，给它赋值。</p>
<p>最后就可以通过键来获取状态。以下是父类，也就是状态+6机类StateMachine中代码：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StateMachine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//1、持有所有状态,并且进行管理和切换;2、负责当前状态的更新</span></span><br><span class="line">  IState currentState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//新建一个 键为System.Type 值为IState类型的字典</span></span><br><span class="line">  <span class="keyword">protected</span> Dictionary&lt;System.Type, IState&gt; stateTbale;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新状态逻辑</span></span><br><span class="line">    currentState.LogicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新物理</span></span><br><span class="line">    currentState.PhysicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SwitchOn</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//状态开启</span></span><br><span class="line">   <span class="comment">//新状态赋值给当前状态,然后启动</span></span><br><span class="line">    currentState = newState;</span><br><span class="line">    currentState.Enter();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//切换状态</span></span><br><span class="line">   <span class="comment">//先关闭状态,然后新状态赋值给当前状态,启动</span></span><br><span class="line">    currentState.Exit();</span><br><span class="line">    SwitchOn(newState);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在玩家状态机类awake()中初始化，更改后的玩家状态机类代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="comment">//public PlayerState_Idle idleState;</span></span><br><span class="line">  <span class="comment">//public PlayerState_Run runState;</span></span><br><span class="line"></span><br><span class="line">  [<span class="meta">SerializeField</span>] PlayerState[] states;<span class="comment">//持有所有状态</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//获取动画</span></span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">    <span class="comment">//字典长度为状态数组长度</span></span><br><span class="line">    stateTbale = <span class="keyword">new</span> Dictionary&lt;System.Type, IState&gt;(states.Length);</span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(animator, <span class="keyword">this</span>);</span><br><span class="line">      stateTbale.Add(state.GetType(), state);<span class="comment">//朝字典添加数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    Debug.Log(<span class="keyword">typeof</span>(PlayerState_Idle));</span><br><span class="line">    <span class="comment">//在字典中传入PlayerState_Idle的类型</span></span><br><span class="line">    <span class="comment">//默认idle</span></span><br><span class="line">    SwitchOn(stateTbale[<span class="keyword">typeof</span>(PlayerState_Idle)]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着会遇到两个报错：PlayerState_Run和PlayerState_Idle类中的状态切换里的变量不存在了。</p>
<p>我们需要回到状态机主类StateMachine，重载状态切换函数SwitchState。将变量类型改为字典需要的键(System.Type类)对比如下:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">IState newState</span>)</span></span><br><span class="line"> &#123;<span class="comment">//切换状态</span></span><br><span class="line">  <span class="comment">//先关闭状态,然后新状态赋值给当前状态,启动</span></span><br><span class="line">   currentState.Exit();</span><br><span class="line">   SwitchOn(newState);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">System.Type newStateType</span>)</span></span><br><span class="line"> &#123;<span class="comment">//切换状态</span></span><br><span class="line">  <span class="comment">//通过字典获取状态，再调用上面那个SwitchState()；</span></span><br><span class="line">   SwitchState(stateTbale[newStateType]);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这样在报错的PlayerState_Run和PlayerState_Idle中修改相应的变量即可：</p>
<p><code>stateMachine.SwitchState(runState);</code></p>
<p>改成了</p>
<p><code>stateMachine.SwitchState(typeof(PlayerState_Run));</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Idle&quot;</span>, fileName = <span class="string">&quot;PlayerState_Idle&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Idle</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Run));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四-Input-System输入系统"><a href="#四-Input-System输入系统" class="headerlink" title="四 Input System输入系统"></a>四 Input System输入系统</h2><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220720175109099.png" alt="image-20220720175109099"></p>
<p>如果需要某个功能对应不同按键都可触发,使用InputSystem会更加方便。不使用输入系统的话需要多个判断语句实现。</p>
<h3 id="4-1-新建Input-Actions"><a href="#4-1-新建Input-Actions" class="headerlink" title="4.1 新建Input Actions"></a>4.1 新建Input Actions</h3><p><strong>命名为PlayerInputActions,玩家输入动作</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722155719378.png" alt="image-20220722155719378"></p>
<h4 id="4-1-1、创建移动动作"><a href="#4-1-1、创建移动动作" class="headerlink" title="4.1.1、创建移动动作"></a>4.1.1、创建移动动作</h4><p><strong>新建GamePlay动作表,重命名动作名为Axes 轴。右边动作类型选value，值类型选二维向量</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722160205417.png" alt="image-20220722160205417"></p>
<p><strong>删除默认的按键，添加预设的上下左右</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162430682.png" alt="image-20220727162430682"></p>
<p><strong>通过listen绑定按键</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162634092.png" alt="image-20220727162634092"></p>
<p><strong>手柄和键盘的模式都改成digital，这样手柄将和键盘一样xy取值只有0,-1,1</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163045286.png" alt="image-20220727163045286"></p>
<h4 id="4-1-2、创建跳跃动作"><a href="#4-1-2、创建跳跃动作" class="headerlink" title="4.1.2、创建跳跃动作"></a>4.1.2、创建跳跃动作</h4><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163504217.png" alt="image-20220727163504217"></p>
<p><strong>记得保存资产</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163532695.png" alt="image-20220727163532695"></p>
<h4 id="4-1-3、生成c-文件"><a href="#4-1-3、生成c-文件" class="headerlink" title="4.1.3、生成c#文件"></a>4.1.3、生成c#文件</h4><p><strong>更改文件位置</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163837612.png" alt="image-20220727163837612"></p>
<h3 id="4-2-初始化玩家输入"><a href="#4-2-初始化玩家输入" class="headerlink" title="4.2 初始化玩家输入"></a>4.2 初始化玩家输入</h3><h4 id="4-2-1、新建脚本PlayerInput-玩家输入类，并且添加到player对象中。"><a href="#4-2-1、新建脚本PlayerInput-玩家输入类，并且添加到player对象中。" class="headerlink" title="4.2.1、新建脚本PlayerInput 玩家输入类，并且添加到player对象中。"></a>4.2.1、新建脚本PlayerInput 玩家输入类，并且添加到player对象中。</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;<span class="comment">//玩家输入类</span></span><br><span class="line"></span><br><span class="line">  PlayerInputActions playerInputAction;<span class="comment">//inputsystem生成的c#文件</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> PlayerMove =&gt; AxisX != <span class="number">0f</span>;<span class="comment">//通过判断x轴是否为0,判断是否移动</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取轴的值 x,y</span></span><br><span class="line">  Vector2 axes =&gt; playerInputAction.GamePlay.Axes.ReadValue&lt;Vector2&gt;();</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">float</span> AxisX =&gt; axes.x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//WasPressedThisFrame()是否按下</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> playerjump =&gt; 		playerInputAction.GamePlay.Jump.WasPressedThisFrame();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//WasReleasedThisFrame()是否松开按键</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> playerstopJump =&gt; playerInputAction.GamePlay.Jump.WasReleasedThisFrame();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    playerInputAction = <span class="keyword">new</span> PlayerInputActions();<span class="comment">//初始化</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnableGameplayInputs</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//启用gameplay动作表（inputsystem中自带的方法，通过.GamePlay.Enable()启动）</span></span><br><span class="line">    playerInputAction.GamePlay.Enable();</span><br><span class="line">    Cursor.lockState = CursorLockMode.Locked;<span class="comment">//鼠标设置为锁定模式 </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2、更改PlayerState-玩家状态脚本，加入玩家输入-初始化"><a href="#4-2-2、更改PlayerState-玩家状态脚本，加入玩家输入-初始化" class="headerlink" title="4.2.2、更改PlayerState 玩家状态脚本，加入玩家输入 初始化"></a>4.2.2、更改PlayerState 玩家状态脚本，加入玩家输入 初始化</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span> : <span class="title">ScriptableObject</span>, <span class="title">IState</span></span><br><span class="line">&#123;<span class="comment">//玩家状态类</span></span><br><span class="line">  <span class="keyword">protected</span> Animator animator;<span class="comment">//动画器</span></span><br><span class="line">  <span class="keyword">protected</span> PlayerInput input;<span class="comment">//玩家输入类</span></span><br><span class="line">  <span class="keyword">protected</span> PlayerStateMachine stateMachine;<span class="comment">//玩家状态机类</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">Animator animator, PlayerInput input, PlayerStateMachine stateMachine</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//初始化状态动画,玩家输入类，玩家状态机</span></span><br><span class="line">    <span class="keyword">this</span>.animator = animator;</span><br><span class="line">    <span class="keyword">this</span>.input = input;</span><br><span class="line">    <span class="keyword">this</span>.stateMachine = stateMachine;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-3、修改PlayerState-Idle和PlayerState-Run脚本"><a href="#4-2-3、修改PlayerState-Idle和PlayerState-Run脚本" class="headerlink" title="4.2.3、修改PlayerState_Idle和PlayerState_Run脚本"></a>4.2.3、修改PlayerState_Idle和PlayerState_Run脚本</h4><p>因为在PlayerInput中,新建了一个变量表示玩家是否移动。原来判断玩家是否在移动的语句优化如下：</p>
<p><strong>旧版通过检测按键a或者d判断:</strong></p>
<p><code>if (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</code></p>
<p><strong>新版判断输入事件x轴是否为0，得出玩家是否正移动:</strong></p>
<p><code>if (input.PlayerMove)</code></p>
<h4 id="4-2-4、在PlayerStateMachine-玩家状态机类中初始化玩家输入"><a href="#4-2-4、在PlayerStateMachine-玩家状态机类中初始化玩家输入" class="headerlink" title="4.2.4、在PlayerStateMachine 玩家状态机类中初始化玩家输入"></a>4.2.4、在PlayerStateMachine 玩家状态机类中初始化玩家输入</h4><p><strong>部分代码如下：</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PlayerInput input;<span class="comment">//玩家输入</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//获取动画</span></span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">    <span class="comment">//获取玩家输入</span></span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字典长度为状态数组长度</span></span><br><span class="line">    stateTbale = <span class="keyword">new</span> Dictionary&lt;System.Type, IState&gt;(states.Length);</span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(animator, input, <span class="keyword">this</span>);</span><br><span class="line">      stateTbale.Add(state.GetType(), state);<span class="comment">//朝字典添加数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-5、在PlayerController-玩家控制器类中添加玩家输入，并且启用动作表"><a href="#4-2-5、在PlayerController-玩家控制器类中添加玩家输入，并且启用动作表" class="headerlink" title="4.2.5、在PlayerController 玩家控制器类中添加玩家输入，并且启用动作表"></a>4.2.5、在PlayerController 玩家控制器类中添加玩家输入，并且启用动作表</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//玩家控制器</span></span><br><span class="line">  PlayerInput input;<span class="comment">//玩家输入类</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();<span class="comment">//获取对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input.EnableGameplayInputs();<span class="comment">//启用动作表</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">region</span> 常规方法(不使用状态机)...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五-玩家移动、转向"><a href="#五-玩家移动、转向" class="headerlink" title="五 玩家移动、转向"></a>五 玩家移动、转向</h2><h3 id="5-1-玩家移动功能实现"><a href="#5-1-玩家移动功能实现" class="headerlink" title="5.1 玩家移动功能实现"></a>5.1 玩家移动功能实现</h3><p>分析:通过刚体模拟物体运动，需要获取player身上的刚体组件。</p>
<p>将玩家移动功能写在<strong>PlayerController玩家控制器</strong>脚本中。</p>
<p>新建刚体变量，获取实例，创建了三个改变刚体速度的函数</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;<span class="comment">//玩家控制器</span></span><br><span class="line">  PlayerInput input;<span class="comment">//玩家输入类</span></span><br><span class="line">  Rigidbody rigidBody;<span class="comment">//刚体类引用变量</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();<span class="comment">//获取对象实例</span></span><br><span class="line">    rigidBody = GetComponent&lt;Rigidbody&gt;();<span class="comment">//获取刚体组件实例</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input.EnableGameplayInputs();<span class="comment">//启用动作表</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVelocity</span>(<span class="params">Vector3 velocity</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//直接修改刚体速度</span></span><br><span class="line">    rigidBody.velocity = velocity;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVelocityX</span>(<span class="params"><span class="built_in">float</span> velocityX</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//将刚体x轴的速度设置为参数的值,y不变。左右移动</span></span><br><span class="line">    rigidBody.velocity = <span class="keyword">new</span> Vector3(velocityX, rigidBody.velocity.y);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVelocityY</span>(<span class="params"><span class="built_in">float</span> velocityY</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//将刚体y轴的速度设置为参数的值,x不变。跳跃或者下落</span></span><br><span class="line">    rigidBody.velocity = <span class="keyword">new</span> Vector3(rigidBody.velocity.x, velocityY);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="keyword">region</span> 常规方法(不使用状态机)...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>PlayerState 玩家状态类</strong>中添加玩家控制器类，并初始化(部分代码)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> PlayerController player;<span class="comment">//玩家控制器</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">PlayerController player, Animator animator, PlayerInput input, PlayerStateMachine stateMachine</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//初始化玩家控制器，状态动画,玩家输入类，玩家状态机</span></span><br><span class="line">    <span class="keyword">this</span>.player = player;</span><br><span class="line">    <span class="keyword">this</span>.animator = animator;</span><br><span class="line">    <span class="keyword">this</span>.input = input;</span><br><span class="line">    <span class="keyword">this</span>.stateMachine = stateMachine;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>PlayerStateMachine 玩家状态机类</strong>一起更新</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line"></span><br><span class="line">  Animator animator;<span class="comment">//动画</span></span><br><span class="line">  PlayerInput input;<span class="comment">//玩家输入</span></span><br><span class="line">  PlayerController playerController;<span class="comment">//玩家状态机</span></span><br><span class="line"></span><br><span class="line">  [<span class="meta">SerializeField</span>] PlayerState[] states;<span class="comment">//持有所有状态</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//获取动画</span></span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">    <span class="comment">//获取玩家输入</span></span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();</span><br><span class="line">    <span class="comment">//获取玩家控制器</span></span><br><span class="line">    playerController = GetComponent&lt;PlayerController&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字典长度为状态数组长度</span></span><br><span class="line">    stateTbale = <span class="keyword">new</span> Dictionary&lt;System.Type, IState&gt;(states.Length);</span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(playerController, animator, input, <span class="keyword">this</span>);</span><br><span class="line">      stateTbale.Add(state.GetType(), state);<span class="comment">//朝字典添加数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Debug.Log(typeof(PlayerState_Idle));</span></span><br><span class="line">    <span class="comment">//在字典中传入PlayerState_Idle的类型</span></span><br><span class="line">    <span class="comment">//默认idle</span></span><br><span class="line">    SwitchOn(stateTbale[<span class="keyword">typeof</span>(PlayerState_Idle)]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<strong>PlayerState_Run 跑步状态脚本</strong>中**重写PhysicUpdate()**方法实现玩家移动</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Run&quot;</span>, fileName = <span class="string">&quot;PlayerState_Run&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Run</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> runSpeed = <span class="number">5f</span>;<span class="comment">//跑步速度</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!input.PlayerMove)</span><br><span class="line">    &#123;<span class="comment">//if玩家没移动输入 则切换状态为idle</span></span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Idle));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    player.SetVelocityX(runSpeed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建变量<strong>runSpeed 跑步速度</strong> 将它序列化，已暴露在编辑器中，至此移动功能实现。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729025838477.png" alt="image-20220729025838477"></p>
<h3 id="5-2-玩家转向"><a href="#5-2-玩家转向" class="headerlink" title="5.2 玩家转向"></a>5.2 玩家转向</h3><h4 id="5-2-1、通过镜像翻转改变玩家朝向"><a href="#5-2-1、通过镜像翻转改变玩家朝向" class="headerlink" title="5.2.1、通过镜像翻转改变玩家朝向"></a>5.2.1、通过镜像翻转改变玩家朝向</h4><p>首先在<strong>PlayerController 玩家控制器</strong>中增加<strong>Move()</strong>,</p>
<p>通过更改Player的localScale的属性<strong>x轴正负(对应axisX轴)值</strong>,同步修改<strong>角色朝向</strong>。</p>
<p>左右移动功能使用速度x方向</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729034552855.png" alt="image-20220729034552855"></p>
<p>然后修改<strong>PlayerState_Run</strong>中**PhysicUpdate()**函数</p>
<p><code>player.SetVelocityX(runSpeed);</code>改为<code>player.Move(runSpeed);</code></p>
<p>新的比旧的多了转向功能。</p>
<h4 id="5-5-2、停止移动"><a href="#5-5-2、停止移动" class="headerlink" title="5.5.2、停止移动"></a>5.5.2、停止移动</h4><p>**PlayerState_Idle类Enter()**中新加一条代码<code>player.SetVelocityX(0f);</code>x轴速度归零</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729035245706.png" alt="image-20220729035245706"></p>
<h3 id="5-3-玩家加速和减速"><a href="#5-3-玩家加速和减速" class="headerlink" title="5.3 玩家加速和减速"></a>5.3 玩家加速和减速</h3><h4 id="5-3-1、实现玩家加速"><a href="#5-3-1、实现玩家加速" class="headerlink" title="5.3.1、实现玩家加速"></a>5.3.1、实现玩家加速</h4><p>在<strong>玩家控制器</strong>中添加一个方法,获取玩家移速。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803155755085.png" alt="image-20220803155755085"></p>
<p>打开<strong>玩家状态类</strong>声明浮点型变量currentSpeed，当前速度</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803170504220.png" alt="image-20220803170504220"></p>
<p>修改<strong>PlayerState_Run</strong>脚本,新增变量acceration加速度，Enter()中获取当前速度，LogicUpdate()中新增缓慢加速的算法。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Run&quot;</span>, fileName = <span class="string">&quot;PlayerState_Run&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Run</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> runSpeed = <span class="number">5f</span>;<span class="comment">//跑步速度</span></span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> acceration = <span class="number">10f</span>;<span class="comment">//加速度</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Run&quot;</span>);</span><br><span class="line">    currentSpeed = player.MoveSpeed;<span class="comment">//获取当前速度</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!input.PlayerMove)</span><br><span class="line">    &#123;<span class="comment">//if玩家没移动输入 则切换状态为idle</span></span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Idle));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从当前速度到指定速度之间随着acceration加速度增加。</span></span><br><span class="line">    currentSpeed = Mathf.MoveTowards(currentSpeed, runSpeed, acceration * Time.deltaTime);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//player.Move(runSpeed);</span></span><br><span class="line">    player.Move(currentSpeed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2、实现玩家减速"><a href="#5-3-2、实现玩家减速" class="headerlink" title="5.3.2、实现玩家减速"></a>5.3.2、实现玩家减速</h4><p>修改<strong>PlayerState_Idle</strong>脚本，新增变量deceleration表示减速加速度，Enter()中记录当前速度，LogicUpdate()中新增缓慢减速算法。重写PhysicUpdate()方法设置减速。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Idle&quot;</span>, fileName = <span class="string">&quot;PlayerState_Idle&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Idle</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> deceleration = <span class="number">5f</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Idle&quot;</span>);<span class="comment">//播放动画器里的idle动画</span></span><br><span class="line">    <span class="comment">//player.SetVelocityX(0f);//x轴速度归零</span></span><br><span class="line">    currentSpeed = player.MoveSpeed;<span class="comment">//记录当前速度</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (input.PlayerMove)</span><br><span class="line">    &#123;<span class="comment">//判断是否移动</span></span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Run));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//减速</span></span><br><span class="line">    currentSpeed = Mathf.MoveTowards(currentSpeed, <span class="number">0</span>, deceleration * Time.deltaTime);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//因为已停止移动 所以不能用Move()，并且需要获取玩家朝向layer.transform.localScale.x</span></span><br><span class="line">    player.SetVelocityX(currentSpeed * player.transform.localScale.x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-相机跟随玩家"><a href="#5-4-相机跟随玩家" class="headerlink" title="5.4 相机跟随玩家"></a>5.4 相机跟随玩家</h3><p>使用<strong>Cinemachine虚拟相机插件</strong>实现。</p>
<p>新建虚拟相机命名为<strong>Virtual Camera Player Follow</strong>，</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803182643175.png" alt="image-20220803182643175"></p>
<p>拖到Cameras下。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804124847239.png" alt="image-20220804124847239"></p>
<p>提前重置两个相机位置，然后将player拖到follow槽中</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125015412.png" alt="image-20220804125015412"></p>
<p>取消勾选Aim选项，这个是用作瞄准用的。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125321555.png" alt="image-20220804125321555"></p>
<p>将body机身改成Framing Transposer取景器</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804131918252.png" alt="image-20220804131918252"></p>
<p>调试参数，选中这个，在试玩时做的操作也会保存</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132030035.png" alt="image-20220804132030035"></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132047150.png" alt="image-20220804132047150"></p>
<hr>
<h2 id="六-优化改进动画播放"><a href="#六-优化改进动画播放" class="headerlink" title="六 优化改进动画播放"></a>六 优化改进动画播放</h2><p><strong>PlayerState玩家状态</strong>脚本中新增三条属性</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135546469.png" alt="image-20220804135546469"></p>
<p>分别用来获取状态动画名称、动画切换时间、声明int类型哈希值。</p>
<p>onenable()中，将获取的<strong>字符串转哈希值</strong>（哈希值占用资源少）。</p>
<p>Enter()中，使用<strong>animator.crossFade()<strong>过渡动画，</strong>淡入淡出效果</strong>。</p>
<p><strong>参数1：字符串或者哈希值，参数2：持续时间。</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135713005.png" alt="image-20220804135713005"></p>
<p>玩家状态<strong>PlayerState_Idle和PlayerState_Run</strong>中的<code>animator.Play()</code>改为<code>base.Enter();</code>继承父类</p>
<p>回到编辑器中只需要在可视化脚本中输入动画名即可.</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804140201463.png" alt="image-20220804140201463"></p>
<hr>
<h2 id="七-玩家跳跃功能"><a href="#七-玩家跳跃功能" class="headerlink" title="七 玩家跳跃功能"></a>七 玩家跳跃功能</h2><h3 id="7-1-地面检测"><a href="#7-1-地面检测" class="headerlink" title="7.1 地面检测"></a>7.1 地面检测</h3><p>要实现跳跃功能，首先要检测地面。</p>
<p>在Player对象下的Ground Detector空对象中添加新的脚本：<strong>PlayerGroundDetector 玩家地面检测器</strong></p>
<p>代码如下:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerGroundDetector</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> detectionRadius = <span class="number">0.1f</span>;<span class="comment">//检测半径</span></span><br><span class="line">  [<span class="meta">SerializeField</span>] LayerMask groundLayer;<span class="comment">//层级</span></span><br><span class="line">  Collider[] colliders = <span class="keyword">new</span> Collider[<span class="number">1</span>];<span class="comment">//碰撞数组</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//Physics.OverlapSphereNonAlloc 检测碰撞个数,不触发回收机制 判断如不为0则返回true</span></span><br><span class="line">  <span class="comment">//IsGrounded:可以判断玩家是否在地面</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> IsGrounded =&gt; Physics.OverlapSphereNonAlloc(transform.position, detectionRadius, colliders,groundLayer) != <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//OnDrawGizmosSelected():系统提供的方法,不是自己建的。  </span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">OnDrawGizmosSelected</span>()</span></span><br><span class="line">  &#123;<span class="comment">//在编辑器中展示 方便调试</span></span><br><span class="line">    Gizmos.color = Color.green;</span><br><span class="line">    Gizmos.DrawWireSphere(transform.position, detectionRadius);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<strong>PlayerController 玩家控制器脚本</strong>中新增代码,以使用玩家地面检测器的参数.</p>
<p>新增内容:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PlayerGroundDetector groundDetector;<span class="comment">//玩家地面检测</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取地面检测结果</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">bool</span> IsGrounded =&gt; groundDetector.IsGrounded;<span class="comment">//true 为已接触</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//判断玩家是否为正在下落,下落时刚体的y速度为负数,并且需要未落地.</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">bool</span> IsFalling =&gt; rigidBody.velocity.y &lt; <span class="number">0f</span> &amp;&amp; !IsGrounded;</span><br></pre></td></tr></table></figure>



<hr>
<h3 id="7-2-检测当前播放动画是否完成"><a href="#7-2-检测当前播放动画是否完成" class="headerlink" title="7.2 检测当前播放动画是否完成"></a>7.2 检测当前播放动画是否完成</h3><p>需要获取:1.动画播放开启的时间;2.当前状态持续时长;3.动画自身播放时长</p>
<p>打开<strong>玩家状态脚本 PlayerState</strong>,新增代码.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> stateStartTime;<span class="comment">//状态开始时间</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//动画是否播放完毕,通过判断 [当前状态的持续时间]是否大于等于[动画本身长度],若大于则动画结束.</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="built_in">bool</span> IsAnimationFinished =&gt; StateDuration &gt;= animator.GetCurrentAnimatorStateInfo(<span class="number">0</span>).length;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//当前状态的持续时间,当前时间减去状态开始时间.</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="built_in">float</span> StateDuration =&gt; Time.time - stateStartTime;</span><br></pre></td></tr></table></figure>

<p><strong>Enter()中给stateStartTime赋值</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;<span class="comment">//animator.CrossFade()交叉淡化函数,可传入哈希值或者string</span></span><br><span class="line">    animator.CrossFade(stateHash, transitionDuration);</span><br><span class="line">    stateStartTime = Time.time;<span class="comment">//记录下状态开始时间</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-玩家跳跃"><a href="#7-3-玩家跳跃" class="headerlink" title="7.3 玩家跳跃"></a>7.3 玩家跳跃</h3><p>新建三个状态类<strong>PlayerState_Fall</strong>,<strong>PlayerState_JumpUp</strong>,<strong>PlayerState_Land</strong>。</p>
<p>玩家按下跳跃键,并且玩家在地面上</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>unity平台跳跃控制器(持续更新)</p><p><a href="https://niaoyu00.github.io/Blog/2022/07/08/unity平台跳跃控制器/">https://niaoyu00.github.io/Blog/2022/07/08/unity平台跳跃控制器/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>ZHY</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-07-08</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-10-03</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/Blog/tags/unity/">unity</a><a class="link-muted mr-2" rel="tag" href="/Blog/tags/%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8/">平台跳跃控制器</a></div><!--!--></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/103.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/116.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Blog/2022/07/12/%E4%BD%BF%E7%94%A8vscode%E5%BC%80%E5%8F%91unity%E9%A1%B9%E7%9B%AE/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">使用vscode开发unity项目</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Blog/2022/06/16/unity%E4%B8%ADInvoke%E7%94%A8%E6%B3%95/"><span class="level-item">unity中Invoke用法</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="SOHUCS" sid="2022/07/08/unity平台跳跃控制器/"></div><script charset="utf-8" src="https://changyan.sohu.com/upload/changyan.js"></script><script>window.changyan.api.config({appid: 'cywj2v52N',conf: 'prod_0e29c15d289cabde4c793c24fd91b220'});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-05T05:46:25.000Z">2022-10-05</time></p><p class="title"><a href="/Blog/2022/10/05/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0-%E6%9E%9A%E4%B8%BE/">算法学习-枚举</a></p><p class="categories"><a href="/Blog/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/">基础学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-04T07:27:55.000Z">2022-10-04</time></p><p class="title"><a href="/Blog/2022/10/04/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0-%E9%80%92%E6%8E%A8%E9%80%86%E6%8E%A8/">算法学习-递推逆推</a></p><p class="categories"><a href="/Blog/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/">基础学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-04T07:26:45.000Z">2022-10-04</time></p><p class="title"><a href="/Blog/2022/10/04/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/">数据结构与算法学习</a></p><p class="categories"><a href="/Blog/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/">基础学习</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-01T10:12:03.000Z">2022-10-01</time></p><p class="title"><a href="/Blog/2022/10/01/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/">开发笔记</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-09-25T10:06:05.000Z">2022-09-25</time></p><p class="title"><a href="/Blog/2022/09/25/Csharp%E4%B8%AD%E9%97%AE%E5%8F%B7%E7%9A%84%E7%94%A8%E6%B3%95/">Csharp中问号的用法（转载）</a></p><p class="categories"><a href="/Blog/categories/Csharp/">Csharp</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Blog/categories/Csharp/"><span class="level-start"><span class="level-item">Csharp</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/git/"><span class="level-start"><span class="level-item">git</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/ue4/"><span class="level-start"><span class="level-item">ue4</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/unity/"><span class="level-start"><span class="level-item">unity</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">基础学习</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">开发工具</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Blog/archives/2022/10/"><span class="level-start"><span class="level-item">十月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/09/"><span class="level-start"><span class="level-item">九月 2022</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/08/"><span class="level-start"><span class="level-item">八月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/07/"><span class="level-start"><span class="level-item">七月 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/06/"><span class="level-start"><span class="level-item">六月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/05/"><span class="level-start"><span class="level-item">五月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/03/"><span class="level-start"><span class="level-item">三月 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/Blog/archives/2021/10/"><span class="level-start"><span class="level-item">十月 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/Blog/img/Bird.png" alt="Niaoyu"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Niaoyu</p><p class="is-size-6 is-block">不如早睡</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>福建</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/Blog/archives"><p class="title">38</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/Blog/categories"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/Blog/tags"><p class="title">15</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Niaoyu00"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/Blog/tags/CSharp/"><span class="tag">CSharp</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Cinemachine-Camera/"><span class="tag">Cinemachine Camera</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Csharp/"><span class="tag">Csharp</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Invoke/"><span class="tag">Invoke</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/OnGUI/"><span class="tag">OnGUI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/ScriptableObject/"><span class="tag">ScriptableObject</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/VsCode/"><span class="tag">VsCode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/git/"><span class="tag">git</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/ue4%E6%9D%90%E8%B4%A8/"><span class="tag">ue4材质</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/unity/"><span class="tag">unity</span><span class="tag">22</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/%E5%A1%94%E9%98%B2demo/"><span class="tag">塔防demo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8/"><span class="tag">平台跳跃控制器</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"><span class="tag">开发笔记</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"><span class="tag">数据结构与算法</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><span class="tag">正则表达式</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/Blog/"><img src="/Blog/img/Bird.png" alt="Niaoyu" height="28"></a><p class="is-size-7"><span>&copy; 2022 ZHY</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: false,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/Blog/js/column.js"></script><script src="/Blog/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/Blog/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="/Blog/js/main.js" defer></script><script src="/Blog/js/custom.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/Blog/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/Blog/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>