<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="ZHY">
    
    <title>
        
            unity平台跳跃控制器 |
        
        Niaoyu
    </title>
    
<link rel="stylesheet" href="/Blog/css/style.css">

    <link rel="shortcut icon" href="/Blog/images/Bird.png">
    
<link rel="stylesheet" href="/Blog/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"niaoyu00.github.io","root":"/Blog/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false},"style":{"primary_color":"#0066CC","avatar":"/images/Bird.png","favicon":"/images/Bird.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/Blog/images/bg.svg","description":"三分钟热度也有三分钟收获"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/Blog/images/Bird.png">
                </a>
            
            <a class="logo-title" href="/">
                Niaoyu
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/Blog/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/Blog/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/Blog/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/Blog/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/Blog/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/Blog/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/Blog/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/Blog/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/Blog/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/Blog/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">unity平台跳跃控制器</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/Blog/images/Bird.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">ZHY</span>
                        
                            <span class="author-label">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-07-08 14:59:54</span>
        <span class="mobile">2022-07-08 14:59</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/Blog/tags/unity/">unity</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="unity平台跳跃控制器"><a href="#unity平台跳跃控制器" class="headerlink" title="unity平台跳跃控制器"></a>unity平台跳跃控制器</h1><h4 id="教程来自b站阿严-https-www-bilibili-com-video-BV1rL4y1W7KH"><a href="#教程来自b站阿严-https-www-bilibili-com-video-BV1rL4y1W7KH" class="headerlink" title="教程来自b站阿严:https://www.bilibili.com/video/BV1rL4y1W7KH"></a>教程来自b站阿严:<a class="link"   target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1rL4y1W7KH" >https://www.bilibili.com/video/BV1rL4y1W7KH<i class="fas fa-external-link-alt"></i></a></h4><hr>
<h2 id="一-项目的创建和管理插件"><a href="#一-项目的创建和管理插件" class="headerlink" title="一 项目的创建和管理插件"></a>一 项目的创建和管理插件</h2><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151216150.png" alt="image-20220708151216150"></p>
<p>删除不需要的插件，安装需要的插件，删除后插件内容：</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708151839520.png" alt="image-20220708151839520"></p>
<h3 id="1-1-安装："><a href="#1-1-安装：" class="headerlink" title="1.1 安装："></a>1.1 安装：</h3><ul>
<li>Cinemachine，虚拟相机插件。</li>
<li>Post Processing，后处理插件。</li>
<li>Input System，新的输入系统插件。</li>
</ul>
<h3 id="1-2-安装完成后图"><a href="#1-2-安装完成后图" class="headerlink" title="1.2 安装完成后图:"></a>1.2 安装完成后图:</h3><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708152529919.png" alt="image-20220708152529919"></p>
<h3 id="1-3-导入资源包"><a href="#1-3-导入资源包" class="headerlink" title="1.3 导入资源包"></a>1.3 导入资源包</h3><p>这里我使用的是自己在unity商店买的资源包，替换了unity酱，想要做点不一样的。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162106523.png" alt="image-20220727162106523"></p>
<hr>
<h2 id="二-状态机系统"><a href="#二-状态机系统" class="headerlink" title="二 状态机系统"></a>二 状态机系统</h2><p>创建接口文件和状态机类</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172046551.png" alt="image-20220708172046551"></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708172412575.png" alt="image-20220708172412575"></p>
<h3 id="2-1-Istate接口"><a href="#2-1-Istate接口" class="headerlink" title="2.1 Istate接口"></a>2.1 Istate接口</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IState</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Enter</span>()</span>;<span class="comment">//状态进入</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Exit</span>()</span>;<span class="comment">//状态退出</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span>;<span class="comment">//状态逻辑更新</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span>;<span class="comment">//状态物理更新</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="2-2-StateMachine类"><a href="#2-2-StateMachine类" class="headerlink" title="2.2 StateMachine类"></a>2.2 StateMachine类</h3><p>作用:</p>
<ul>
<li>持有所有状态,并且进行管理和切换;</li>
<li>负责当前状态的更新.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StateMachine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//1、持有所有状态,并且进行管理和切换;2、负责当前状态的更新</span></span><br><span class="line">  IState currentState;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新状态逻辑</span></span><br><span class="line">    currentState.LogicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新物理</span></span><br><span class="line">    currentState.PhysicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SwitchOn</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//状态开启</span></span><br><span class="line">   <span class="comment">//新状态赋值给当前状态,然后启动</span></span><br><span class="line">    currentState = newState;</span><br><span class="line">    currentState.Enter();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//切换状态</span></span><br><span class="line">   <span class="comment">//先关闭状态,然后新状态赋值给当前状态,启动</span></span><br><span class="line">    currentState.Exit();</span><br><span class="line">    SwitchOn(newState);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三-扩展状态机系统"><a href="#三-扩展状态机系统" class="headerlink" title="三 扩展状态机系统"></a>三 扩展状态机系统</h2><p><strong>创建PlayerStates(玩家状态)并初始化</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span> : <span class="title">ScriptableObject</span>, <span class="title">IState</span></span><br><span class="line">&#123;<span class="comment">//玩家状态类</span></span><br><span class="line">  Animator animator;<span class="comment">//动画器</span></span><br><span class="line">  PlayerStateMachine stateMachine;<span class="comment">//玩家状态机类</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">Animator animator, PlayerStateMachine stateMachine</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">this</span>.animator = animator;</span><br><span class="line">    <span class="keyword">this</span>.stateMachine = stateMachine;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>PlayerStatesMachine(玩家状态机)</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-状态机系统继承关系图"><a href="#3-1-状态机系统继承关系图" class="headerlink" title="3.1 状态机系统继承关系图"></a>3.1 状态机系统继承关系图</h3><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220708193345419.png" alt="image-20220708193345419"></p>
<h3 id="3-2-使用两种方法实现角色动画"><a href="#3-2-使用两种方法实现角色动画" class="headerlink" title="3.2 使用两种方法实现角色动画"></a>3.2 使用两种方法实现角色动画</h3><h4 id="3-2-1、常规方法-不使用状态机"><a href="#3-2-1、常规方法-不使用状态机" class="headerlink" title="3.2.1、常规方法(不使用状态机)"></a>3.2.1、常规方法(不使用状态机)</h4><p><strong>构建基础状态机系统,创建动画控制器</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153516317.png" alt="image-20220715153516317"></p>
<p><strong>拖到玩家对象</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153636233.png" alt="image-20220715153636233"></p>
<p><strong>将动画拖入控制器</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715153742399.png" alt="image-20220715153742399"></p>
<p><strong>更改默认状态</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715154429486.png" alt="image-20220715154429486"></p>
<p><strong>然后在player对象添加玩家控制器脚本</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715155527938.png" alt="image-20220715155527938"></p>
<p><strong>需求分析:</strong></p>
<ul>
<li>按下A&#x2F;D键时播放跑步动画</li>
<li>松开按键回到空闲动画</li>
</ul>
<p><strong>实现方式：</strong></p>
<ul>
<li>获取键盘的输入信号(Input System)</li>
<li>播放特定动画(Animator)</li>
</ul>
<p><strong>PlayerController代码如下：</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();<span class="comment">//获取动画控制组件</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//按住当前键盘的a或者d键</span></span><br><span class="line">    <span class="comment">//if(Input.GetKey(KeyCode.A)|| Input.GetKey(KeyCode.D))</span></span><br><span class="line">    <span class="keyword">if</span> (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">      animator.Play(<span class="string">&quot;Run&quot;</span>);<span class="comment">//播放动画器中特定动画</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span><span class="comment">//松开按键时</span></span><br><span class="line">    &#123;</span><br><span class="line">      animator.Play(<span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>并且同时更改动画器中动画的名字，以匹配代码中的命名</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161313196.png" alt="image-20220715161313196"></p>
<p><strong>全部改完效果如图：</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715161513401.png" alt="image-20220715161513401"></p>
<h4 id="3-2-2、通过状态机实现动画状态切换"><a href="#3-2-2、通过状态机实现动画状态切换" class="headerlink" title="3.2.2、通过状态机实现动画状态切换"></a>3.2.2、通过状态机实现动画状态切换</h4><p><strong>首先将状态机脚本添加到玩家上</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162041929.png" alt="image-20220715162041929"></p>
<p><strong>其次在Player State文件夹中创建idle和run状态脚本</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719030021036.png" alt="image-20220719030021036"></p>
<p>皆继承于PlayerState</p>
<p><code>[CreateAssetMenu(menuName = &quot;Data/StateMachine/PlayerState/Idle&quot;, fileName = &quot;PlayerState_Idle&quot;)]</code></p>
<p>这条代码将代码暴露在编辑器中，可在文件夹中创建可程序化对象文件</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715162722895.png" alt="image-20220715162722895"></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220715163129842.png" alt="image-20220715163129842"></p>
<p><strong>举例PlayerState_Idle代码如下:</strong></p>
<p><strong>重写状态函数,更新状态</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Idle&quot;</span>, fileName = <span class="string">&quot;PlayerState_Idle&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Idle</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">      stateMachine.SwitchState(stateMachine.runState);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>PlayerState_Idle脚本代码同理。</strong></p>
<p><strong>状态机模式将不同状态分开来处理,这个模式中只需要思考,当前状态如何切换到下一状态,而不再需要同时考虑另一个状态的逻辑问题。</strong></p>
<p><strong>(例如需要落地后才可起跳，常规方法需要使用很多Boolean值来判断状态，而状态机模式只需要在各自状态中实现切换即可)</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220719042545564.png" alt="image-20220719042545564"></p>
<h3 id="3-3-状态机模式优缺点"><a href="#3-3-状态机模式优缺点" class="headerlink" title="3.3 状态机模式优缺点"></a>3.3 状态机模式优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>逻辑分开到各个状态中处理，不需要考虑状态之间的约束，让思路更清楚。</li>
<li>代码性能提升</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>文件数量增加</li>
<li>代码重复</li>
</ul>
<h3 id="3-4-继续完善状态机功能"><a href="#3-4-继续完善状态机功能" class="headerlink" title="3.4 继续完善状态机功能"></a>3.4 继续完善状态机功能</h3><p><strong>打开玩家状态机脚本PlayerStateMachine</strong></p>
<p>目前所有新状态都需要新建初始化,是否可以声明一个鸡和然后将所有状态都扔进去呢?当然可以。</p>
<p><strong>首先修改玩家状态机类的代码，(注释中是原代码)</strong></p>
<p>我们新建一个states数组，通过遍历获取玩家具体状态。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="comment">//public PlayerState_Idle idleState;</span></span><br><span class="line">  <span class="comment">//public PlayerState_Run runState;</span></span><br><span class="line">    </span><br><span class="line">  [<span class="meta">SerializeField</span>] PlayerState[] states;<span class="comment">//持有所有状态</span></span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(animator, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    SwitchOn(【idleState】);<span class="comment">//默认idle，【idleState】报错，需要通过字典</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么做<code>idleState</code>会出现报错，</p>
<p>这时需要在<strong>父类创建字典</strong>，声明一个<strong>键为System.Type值为IState类型</strong>的字典</p>
<p>然后在玩家状态机类PlayerStateMachine中的状态遍历循环中，给它赋值。</p>
<p>最后就可以通过键来获取状态。以下是父类，也就是状态+6机类StateMachine中代码：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">StateMachine</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//1、持有所有状态,并且进行管理和切换;2、负责当前状态的更新</span></span><br><span class="line">  IState currentState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//新建一个 键为System.Type 值为IState类型的字典</span></span><br><span class="line">  <span class="keyword">protected</span> Dictionary&lt;System.Type, IState&gt; stateTbale;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新状态逻辑</span></span><br><span class="line">    currentState.LogicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//更新物理</span></span><br><span class="line">    currentState.PhysicUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">SwitchOn</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//状态开启</span></span><br><span class="line">   <span class="comment">//新状态赋值给当前状态,然后启动</span></span><br><span class="line">    currentState = newState;</span><br><span class="line">    currentState.Enter();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">IState newState</span>)</span></span><br><span class="line">  &#123;<span class="comment">//切换状态</span></span><br><span class="line">   <span class="comment">//先关闭状态,然后新状态赋值给当前状态,启动</span></span><br><span class="line">    currentState.Exit();</span><br><span class="line">    SwitchOn(newState);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着在玩家状态机类awake()中初始化，更改后的玩家状态机类代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line">  Animator animator;</span><br><span class="line">  <span class="comment">//public PlayerState_Idle idleState;</span></span><br><span class="line">  <span class="comment">//public PlayerState_Run runState;</span></span><br><span class="line"></span><br><span class="line">  [<span class="meta">SerializeField</span>] PlayerState[] states;<span class="comment">//持有所有状态</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//获取动画</span></span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">    <span class="comment">//字典长度为状态数组长度</span></span><br><span class="line">    stateTbale = <span class="keyword">new</span> Dictionary&lt;System.Type, IState&gt;(states.Length);</span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(animator, <span class="keyword">this</span>);</span><br><span class="line">      stateTbale.Add(state.GetType(), state);<span class="comment">//朝字典添加数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    Debug.Log(<span class="keyword">typeof</span>(PlayerState_Idle));</span><br><span class="line">    <span class="comment">//在字典中传入PlayerState_Idle的类型</span></span><br><span class="line">    <span class="comment">//默认idle</span></span><br><span class="line">    SwitchOn(stateTbale[<span class="keyword">typeof</span>(PlayerState_Idle)]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着会遇到两个报错：PlayerState_Run和PlayerState_Idle类中的状态切换里的变量不存在了。</p>
<p>我们需要回到状态机主类StateMachine，重载状态切换函数SwitchState。将变量类型改为字典需要的键(System.Type类)对比如下:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">IState newState</span>)</span></span><br><span class="line"> &#123;<span class="comment">//切换状态</span></span><br><span class="line">  <span class="comment">//先关闭状态,然后新状态赋值给当前状态,启动</span></span><br><span class="line">   currentState.Exit();</span><br><span class="line">   SwitchOn(newState);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SwitchState</span>(<span class="params">System.Type newStateType</span>)</span></span><br><span class="line"> &#123;<span class="comment">//切换状态</span></span><br><span class="line">  <span class="comment">//通过字典获取状态，再调用上面那个SwitchState()；</span></span><br><span class="line">   SwitchState(stateTbale[newStateType]);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>这样在报错的PlayerState_Run和PlayerState_Idle中修改相应的变量即可：</p>
<p><code>stateMachine.SwitchState(runState);</code></p>
<p>改成了</p>
<p><code>stateMachine.SwitchState(typeof(PlayerState_Run));</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Idle&quot;</span>, fileName = <span class="string">&quot;PlayerState_Idle&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Idle</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Idle&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</span><br><span class="line">    &#123;</span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Run));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四-Input-System输入系统"><a href="#四-Input-System输入系统" class="headerlink" title="四 Input System输入系统"></a>四 Input System输入系统</h2><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220720175109099.png" alt="image-20220720175109099"></p>
<p>如果需要某个功能对应不同按键都可触发,使用InputSystem会更加方便。不使用输入系统的话需要多个判断语句实现。</p>
<h3 id="4-1-新建Input-Actions"><a href="#4-1-新建Input-Actions" class="headerlink" title="4.1 新建Input Actions"></a>4.1 新建Input Actions</h3><p><strong>命名为PlayerInputActions,玩家输入动作</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722155719378.png" alt="image-20220722155719378"></p>
<h4 id="4-1-1、创建移动动作"><a href="#4-1-1、创建移动动作" class="headerlink" title="4.1.1、创建移动动作"></a>4.1.1、创建移动动作</h4><p><strong>新建GamePlay动作表,重命名动作名为Axes 轴。右边动作类型选value，值类型选二维向量</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220722160205417.png" alt="image-20220722160205417"></p>
<p><strong>删除默认的按键，添加预设的上下左右</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162430682.png" alt="image-20220727162430682"></p>
<p><strong>通过listen绑定按键</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727162634092.png" alt="image-20220727162634092"></p>
<p><strong>手柄和键盘的模式都改成digital，这样手柄将和键盘一样xy取值只有0,-1,1</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163045286.png" alt="image-20220727163045286"></p>
<h4 id="4-1-2、创建跳跃动作"><a href="#4-1-2、创建跳跃动作" class="headerlink" title="4.1.2、创建跳跃动作"></a>4.1.2、创建跳跃动作</h4><p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163504217.png" alt="image-20220727163504217"></p>
<p><strong>记得保存资产</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163532695.png" alt="image-20220727163532695"></p>
<h4 id="4-1-3、生成c-文件"><a href="#4-1-3、生成c-文件" class="headerlink" title="4.1.3、生成c#文件"></a>4.1.3、生成c#文件</h4><p><strong>更改文件位置</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220727163837612.png" alt="image-20220727163837612"></p>
<h3 id="4-2-初始化玩家输入"><a href="#4-2-初始化玩家输入" class="headerlink" title="4.2 初始化玩家输入"></a>4.2 初始化玩家输入</h3><h4 id="4-2-1、新建脚本PlayerInput-玩家输入类，并且添加到player对象中。"><a href="#4-2-1、新建脚本PlayerInput-玩家输入类，并且添加到player对象中。" class="headerlink" title="4.2.1、新建脚本PlayerInput 玩家输入类，并且添加到player对象中。"></a>4.2.1、新建脚本PlayerInput 玩家输入类，并且添加到player对象中。</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;<span class="comment">//玩家输入类</span></span><br><span class="line"></span><br><span class="line">  PlayerInputActions playerInputAction;<span class="comment">//inputsystem生成的c#文件</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> PlayerMove =&gt; AxisX != <span class="number">0f</span>;<span class="comment">//通过判断x轴是否为0,判断是否移动</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取轴的值 x,y</span></span><br><span class="line">  Vector2 axes =&gt; playerInputAction.GamePlay.Axes.ReadValue&lt;Vector2&gt;();</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">float</span> AxisX =&gt; axes.x;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//WasPressedThisFrame()是否按下</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> playerjump =&gt; 		playerInputAction.GamePlay.Jump.WasPressedThisFrame();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//WasReleasedThisFrame()是否松开按键</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> playerstopJump =&gt; playerInputAction.GamePlay.Jump.WasReleasedThisFrame();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    playerInputAction = <span class="keyword">new</span> PlayerInputActions();<span class="comment">//初始化</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">EnableGameplayInputs</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//启用gameplay动作表（inputsystem中自带的方法，通过.GamePlay.Enable()启动）</span></span><br><span class="line">    playerInputAction.GamePlay.Enable();</span><br><span class="line">    Cursor.lockState = CursorLockMode.Locked;<span class="comment">//鼠标设置为锁定模式 </span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-2、更改PlayerState-玩家状态脚本，加入玩家输入-初始化"><a href="#4-2-2、更改PlayerState-玩家状态脚本，加入玩家输入-初始化" class="headerlink" title="4.2.2、更改PlayerState 玩家状态脚本，加入玩家输入 初始化"></a>4.2.2、更改PlayerState 玩家状态脚本，加入玩家输入 初始化</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState</span> : <span class="title">ScriptableObject</span>, <span class="title">IState</span></span><br><span class="line">&#123;<span class="comment">//玩家状态类</span></span><br><span class="line">  <span class="keyword">protected</span> Animator animator;<span class="comment">//动画器</span></span><br><span class="line">  <span class="keyword">protected</span> PlayerInput input;<span class="comment">//玩家输入类</span></span><br><span class="line">  <span class="keyword">protected</span> PlayerStateMachine stateMachine;<span class="comment">//玩家状态机类</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">Animator animator, PlayerInput input, PlayerStateMachine stateMachine</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//初始化状态动画,玩家输入类，玩家状态机</span></span><br><span class="line">    <span class="keyword">this</span>.animator = animator;</span><br><span class="line">    <span class="keyword">this</span>.input = input;</span><br><span class="line">    <span class="keyword">this</span>.stateMachine = stateMachine;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Exit</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-3、修改PlayerState-Idle和PlayerState-Run脚本"><a href="#4-2-3、修改PlayerState-Idle和PlayerState-Run脚本" class="headerlink" title="4.2.3、修改PlayerState_Idle和PlayerState_Run脚本"></a>4.2.3、修改PlayerState_Idle和PlayerState_Run脚本</h4><p>因为在PlayerInput中,新建了一个变量表示玩家是否移动。原来判断玩家是否在移动的语句优化如下：</p>
<p><strong>旧版通过检测按键a或者d判断:</strong></p>
<p><code>if (Keyboard.current.aKey.isPressed || Keyboard.current.dKey.isPressed)</code></p>
<p><strong>新版判断输入事件x轴是否为0，得出玩家是否正移动:</strong></p>
<p><code>if (input.PlayerMove)</code></p>
<h4 id="4-2-4、在PlayerStateMachine-玩家状态机类中初始化玩家输入"><a href="#4-2-4、在PlayerStateMachine-玩家状态机类中初始化玩家输入" class="headerlink" title="4.2.4、在PlayerStateMachine 玩家状态机类中初始化玩家输入"></a>4.2.4、在PlayerStateMachine 玩家状态机类中初始化玩家输入</h4><p><strong>部分代码如下：</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PlayerInput input;<span class="comment">//玩家输入</span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//获取动画</span></span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">    <span class="comment">//获取玩家输入</span></span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字典长度为状态数组长度</span></span><br><span class="line">    stateTbale = <span class="keyword">new</span> Dictionary&lt;System.Type, IState&gt;(states.Length);</span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(animator, input, <span class="keyword">this</span>);</span><br><span class="line">      stateTbale.Add(state.GetType(), state);<span class="comment">//朝字典添加数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-5、在PlayerController-玩家控制器类中添加玩家输入，并且启用动作表"><a href="#4-2-5、在PlayerController-玩家控制器类中添加玩家输入，并且启用动作表" class="headerlink" title="4.2.5、在PlayerController 玩家控制器类中添加玩家输入，并且启用动作表"></a>4.2.5、在PlayerController 玩家控制器类中添加玩家输入，并且启用动作表</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//玩家控制器</span></span><br><span class="line">  PlayerInput input;<span class="comment">//玩家输入类</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();<span class="comment">//获取对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input.EnableGameplayInputs();<span class="comment">//启用动作表</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">region</span> 常规方法(不使用状态机)...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="五-玩家移动、转向"><a href="#五-玩家移动、转向" class="headerlink" title="五 玩家移动、转向"></a>五 玩家移动、转向</h2><h3 id="5-1-玩家移动功能实现"><a href="#5-1-玩家移动功能实现" class="headerlink" title="5.1 玩家移动功能实现"></a>5.1 玩家移动功能实现</h3><p>分析:通过刚体模拟物体运动，需要获取player身上的刚体组件。</p>
<p>将玩家移动功能写在<strong>PlayerController玩家控制器</strong>脚本中。</p>
<p>新建刚体变量，获取实例，创建了三个改变刚体速度的函数</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.InputSystem;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;<span class="comment">//玩家控制器</span></span><br><span class="line">  PlayerInput input;<span class="comment">//玩家输入类</span></span><br><span class="line">  Rigidbody rigidBody;<span class="comment">//刚体类引用变量</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();<span class="comment">//获取对象实例</span></span><br><span class="line">    rigidBody = GetComponent&lt;Rigidbody&gt;();<span class="comment">//获取刚体组件实例</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    input.EnableGameplayInputs();<span class="comment">//启用动作表</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVelocity</span>(<span class="params">Vector3 velocity</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//直接修改刚体速度</span></span><br><span class="line">    rigidBody.velocity = velocity;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVelocityX</span>(<span class="params"><span class="built_in">float</span> velocityX</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//将刚体x轴的速度设置为参数的值,y不变。左右移动</span></span><br><span class="line">    rigidBody.velocity = <span class="keyword">new</span> Vector3(velocityX, rigidBody.velocity.y);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetVelocityY</span>(<span class="params"><span class="built_in">float</span> velocityY</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//将刚体y轴的速度设置为参数的值,x不变。跳跃或者下落</span></span><br><span class="line">    rigidBody.velocity = <span class="keyword">new</span> Vector3(rigidBody.velocity.x, velocityY);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="keyword">region</span> 常规方法(不使用状态机)...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>PlayerState 玩家状态类</strong>中添加玩家控制器类，并初始化(部分代码)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> PlayerController player;<span class="comment">//玩家控制器</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initialize</span>(<span class="params">PlayerController player, Animator animator, PlayerInput input, PlayerStateMachine stateMachine</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//初始化玩家控制器，状态动画,玩家输入类，玩家状态机</span></span><br><span class="line">    <span class="keyword">this</span>.player = player;</span><br><span class="line">    <span class="keyword">this</span>.animator = animator;</span><br><span class="line">    <span class="keyword">this</span>.input = input;</span><br><span class="line">    <span class="keyword">this</span>.stateMachine = stateMachine;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>PlayerStateMachine 玩家状态机类</strong>一起更新</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerStateMachine</span> : <span class="title">StateMachine</span></span><br><span class="line">&#123;<span class="comment">//玩家状态机</span></span><br><span class="line"></span><br><span class="line">  Animator animator;<span class="comment">//动画</span></span><br><span class="line">  PlayerInput input;<span class="comment">//玩家输入</span></span><br><span class="line">  PlayerController playerController;<span class="comment">//玩家状态机</span></span><br><span class="line"></span><br><span class="line">  [<span class="meta">SerializeField</span>] PlayerState[] states;<span class="comment">//持有所有状态</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//获取动画</span></span><br><span class="line">    animator = GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">    <span class="comment">//获取玩家输入</span></span><br><span class="line">    input = GetComponent&lt;PlayerInput&gt;();</span><br><span class="line">    <span class="comment">//获取玩家控制器</span></span><br><span class="line">    playerController = GetComponent&lt;PlayerController&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字典长度为状态数组长度</span></span><br><span class="line">    stateTbale = <span class="keyword">new</span> Dictionary&lt;System.Type, IState&gt;(states.Length);</span><br><span class="line">    <span class="comment">//可以在此初始化 玩家状态</span></span><br><span class="line">    <span class="comment">//idleState.Initialize(animator, this);</span></span><br><span class="line">    <span class="comment">//runState.Initialize(animator, this);</span></span><br><span class="line">    <span class="keyword">foreach</span> (PlayerState state <span class="keyword">in</span> states)</span><br><span class="line">    &#123;</span><br><span class="line">      state.Initialize(playerController, animator, input, <span class="keyword">this</span>);</span><br><span class="line">      stateTbale.Add(state.GetType(), state);<span class="comment">//朝字典添加数据</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Debug.Log(typeof(PlayerState_Idle));</span></span><br><span class="line">    <span class="comment">//在字典中传入PlayerState_Idle的类型</span></span><br><span class="line">    <span class="comment">//默认idle</span></span><br><span class="line">    SwitchOn(stateTbale[<span class="keyword">typeof</span>(PlayerState_Idle)]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<strong>PlayerState_Run 跑步状态脚本</strong>中**重写PhysicUpdate()**方法实现玩家移动</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Run&quot;</span>, fileName = <span class="string">&quot;PlayerState_Run&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Run</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> runSpeed = <span class="number">5f</span>;<span class="comment">//跑步速度</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Run&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!input.PlayerMove)</span><br><span class="line">    &#123;<span class="comment">//if玩家没移动输入 则切换状态为idle</span></span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Idle));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    player.SetVelocityX(runSpeed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建变量<strong>runSpeed 跑步速度</strong> 将它序列化，已暴露在编辑器中，至此移动功能实现。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729025838477.png" alt="image-20220729025838477"></p>
<h3 id="5-2-玩家转向"><a href="#5-2-玩家转向" class="headerlink" title="5.2 玩家转向"></a>5.2 玩家转向</h3><h4 id="5-2-1、通过镜像翻转改变玩家朝向"><a href="#5-2-1、通过镜像翻转改变玩家朝向" class="headerlink" title="5.2.1、通过镜像翻转改变玩家朝向"></a>5.2.1、通过镜像翻转改变玩家朝向</h4><p>首先在<strong>PlayerController 玩家控制器</strong>中增加<strong>Move()</strong>,</p>
<p>通过更改Player的localScale的属性<strong>x轴正负(对应axisX轴)值</strong>,同步修改<strong>角色朝向</strong>。</p>
<p>左右移动功能使用速度x方向</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729034552855.png" alt="image-20220729034552855"></p>
<p>然后修改<strong>PlayerState_Run</strong>中**PhysicUpdate()**函数</p>
<p><code>player.SetVelocityX(runSpeed);</code>改为<code>player.Move(runSpeed);</code></p>
<p>新的比旧的多了转向功能。</p>
<h4 id="5-5-2、停止移动"><a href="#5-5-2、停止移动" class="headerlink" title="5.5.2、停止移动"></a>5.5.2、停止移动</h4><p>**PlayerState_Idle类Enter()**中新加一条代码<code>player.SetVelocityX(0f);</code>x轴速度归零</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220729035245706.png" alt="image-20220729035245706"></p>
<h3 id="5-3-玩家加速和减速"><a href="#5-3-玩家加速和减速" class="headerlink" title="5.3 玩家加速和减速"></a>5.3 玩家加速和减速</h3><h4 id="5-3-1、实现玩家加速"><a href="#5-3-1、实现玩家加速" class="headerlink" title="5.3.1、实现玩家加速"></a>5.3.1、实现玩家加速</h4><p>在<strong>玩家控制器</strong>中添加一个方法,获取玩家移速。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803155755085.png" alt="image-20220803155755085"></p>
<p>打开<strong>玩家状态类</strong>声明浮点型变量currentSpeed，当前速度</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803170504220.png" alt="image-20220803170504220"></p>
<p>修改<strong>PlayerState_Run</strong>脚本,新增变量acceration加速度，Enter()中获取当前速度，LogicUpdate()中新增缓慢加速的算法。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Run&quot;</span>, fileName = <span class="string">&quot;PlayerState_Run&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Run</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> runSpeed = <span class="number">5f</span>;<span class="comment">//跑步速度</span></span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> acceration = <span class="number">10f</span>;<span class="comment">//加速度</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Run&quot;</span>);</span><br><span class="line">    currentSpeed = player.MoveSpeed;<span class="comment">//获取当前速度</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (!input.PlayerMove)</span><br><span class="line">    &#123;<span class="comment">//if玩家没移动输入 则切换状态为idle</span></span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Idle));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从当前速度到指定速度之间随着acceration加速度增加。</span></span><br><span class="line">    currentSpeed = Mathf.MoveTowards(currentSpeed, runSpeed, acceration * Time.deltaTime);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//player.Move(runSpeed);</span></span><br><span class="line">    player.Move(currentSpeed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2、实现玩家减速"><a href="#5-3-2、实现玩家减速" class="headerlink" title="5.3.2、实现玩家减速"></a>5.3.2、实现玩家减速</h4><p>修改<strong>PlayerState_Idle</strong>脚本，新增变量deceleration表示减速加速度，Enter()中记录当前速度，LogicUpdate()中新增缓慢减速算法。重写PhysicUpdate()方法设置减速。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;Data/StateMachine/PlayerState/Idle&quot;</span>, fileName = <span class="string">&quot;PlayerState_Idle&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerState_Idle</span> : <span class="title">PlayerState</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> deceleration = <span class="number">5f</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Enter</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    animator.Play(<span class="string">&quot;Idle&quot;</span>);<span class="comment">//播放动画器里的idle动画</span></span><br><span class="line">    <span class="comment">//player.SetVelocityX(0f);//x轴速度归零</span></span><br><span class="line">    currentSpeed = player.MoveSpeed;<span class="comment">//记录当前速度</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">LogicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (input.PlayerMove)</span><br><span class="line">    &#123;<span class="comment">//判断是否移动</span></span><br><span class="line">      stateMachine.SwitchState(<span class="keyword">typeof</span>(PlayerState_Run));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//减速</span></span><br><span class="line">    currentSpeed = Mathf.MoveTowards(currentSpeed, <span class="number">0</span>, deceleration * Time.deltaTime);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">PhysicUpdate</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//因为已停止移动 所以不能用Move()，并且需要获取玩家朝向layer.transform.localScale.x</span></span><br><span class="line">    player.SetVelocityX(currentSpeed * player.transform.localScale.x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-相机跟随玩家"><a href="#5-4-相机跟随玩家" class="headerlink" title="5.4 相机跟随玩家"></a>5.4 相机跟随玩家</h3><p>使用<strong>Cinemachine虚拟相机插件</strong>实现。</p>
<p>新建虚拟相机命名为<strong>Virtual Camera Player Follow</strong>，</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220803182643175.png" alt="image-20220803182643175"></p>
<p>拖到Cameras下。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804124847239.png" alt="image-20220804124847239"></p>
<p>提前重置两个相机位置，然后将player拖到follow槽中</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125015412.png" alt="image-20220804125015412"></p>
<p>取消勾选Aim选项，这个是用作瞄准用的。</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804125321555.png" alt="image-20220804125321555"></p>
<p>将body机身改成Framing Transposer取景器</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804131918252.png" alt="image-20220804131918252"></p>
<p>调试参数，选中这个，在试玩时做的操作也会保存</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132030035.png" alt="image-20220804132030035"></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804132047150.png" alt="image-20220804132047150"></p>
<hr>
<h2 id="六-优化改进动画播放"><a href="#六-优化改进动画播放" class="headerlink" title="六 优化改进动画播放"></a>六 优化改进动画播放</h2><p><strong>PlayerState玩家状态</strong>脚本中新增三条属性</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135546469.png" alt="image-20220804135546469"></p>
<p>分别用来获取状态动画名称、动画切换时间、声明int类型哈希值。</p>
<p>onenable()中，将获取的<strong>字符串转哈希值</strong>（哈希值占用资源少）。</p>
<p>Enter()中，使用<strong>animator.crossFade()<strong>过渡动画，</strong>淡入淡出效果</strong>。</p>
<p><strong>参数1：字符串或者哈希值，参数2：持续时间。</strong></p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804135713005.png" alt="image-20220804135713005"></p>
<p>玩家状态<strong>PlayerState_Idle和PlayerState_Run</strong>中的<code>animator.Play()</code>改为<code>base.Enter();</code>继承父类</p>
<p>回到编辑器中只需要在可视化脚本中输入动画名即可</p>
<p><img src="https://raw.githubusercontent.com/Niaoyu00/pics/main/image-20220804140201463.png" alt="image-20220804140201463"></p>
<hr>
<h2 id="七-玩家跳跃功能"><a href="#七-玩家跳跃功能" class="headerlink" title="七 玩家跳跃功能"></a>七 玩家跳跃功能</h2><h3 id="7-1-地面检测"><a href="#7-1-地面检测" class="headerlink" title="7.1 地面检测"></a>7.1 地面检测</h3><p>要实现跳跃功能，首先要检测地面。</p>
<p>在Player对象下的Ground Detector空对象中添加新的脚本：<strong>PlayerGroundDetector 玩家地面检测器</strong></p>
<p>代码如下:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerGroundDetector</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">  [<span class="meta">SerializeField</span>] <span class="built_in">float</span> detectionRadius = <span class="number">0.1f</span>;<span class="comment">//检测半径</span></span><br><span class="line">  [<span class="meta">SerializeField</span>] LayerMask groundLayer;<span class="comment">//层级</span></span><br><span class="line">  Collider[] colliders = <span class="keyword">new</span> Collider[<span class="number">1</span>];<span class="comment">//碰撞数组</span></span><br><span class="line">  <span class="comment">//Physics.OverlapSphereNonAlloc 检测碰撞个数,不触发回收机制 判断如不为0则返回true</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">bool</span> IsGrounded =&gt; Physics.OverlapSphereNonAlloc(transform.position, detectionRadius, colliders,groundLayer) != <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">OnDrawGizmosSelected</span>()</span></span><br><span class="line">  &#123;<span class="comment">//在编辑器中展示 方便调试</span></span><br><span class="line">    Gizmos.color = Color.green;</span><br><span class="line">    Gizmos.DrawWireSphere(transform.position, detectionRadius);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>新建三个状态类<strong>PlayerState_Fall</strong>,<strong>PlayerState_JumpUp</strong>,<strong>PlayerState_Land</strong>。</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>本文标题：unity平台跳跃控制器</li>
        <li>本文作者：ZHY</li>
        <li>创建时间：2022-07-08 14:59:54</li>
        <li>
            本文链接：https://niaoyu00.github.io/Blog/2022/07/08/unity平台跳跃笔记/
        </li>
        <li>
            版权声明：本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/Blog/tags/unity/">#unity</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/Blog/2022/07/12/%E4%BD%BF%E7%94%A8vscode%E5%BC%80%E5%8F%91unity%E9%A1%B9%E7%9B%AE/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">使用vscode开发unity项目</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/Blog/2022/06/16/unity%E4%B8%ADInvoke%E7%94%A8%E6%B3%95/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">unity中Invoke用法</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2022&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">ZHY</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#unity%E5%B9%B3%E5%8F%B0%E8%B7%B3%E8%B7%83%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-text">unity平台跳跃控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%99%E7%A8%8B%E6%9D%A5%E8%87%AAb%E7%AB%99%E9%98%BF%E4%B8%A5-https-www-bilibili-com-video-BV1rL4y1W7KH"><span class="nav-text">教程来自b站阿严:https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1rL4y1W7KH</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80-%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E6%8F%92%E4%BB%B6"><span class="nav-text">一 项目的创建和管理插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%AE%89%E8%A3%85%EF%BC%9A"><span class="nav-text">1.1 安装：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E5%90%8E%E5%9B%BE"><span class="nav-text">1.2 安装完成后图:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%AF%BC%E5%85%A5%E8%B5%84%E6%BA%90%E5%8C%85"><span class="nav-text">1.3 导入资源包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C-%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E7%BB%9F"><span class="nav-text">二 状态机系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Istate%E6%8E%A5%E5%8F%A3"><span class="nav-text">2.1 Istate接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-StateMachine%E7%B1%BB"><span class="nav-text">2.2 StateMachine类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89-%E6%89%A9%E5%B1%95%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E7%BB%9F"><span class="nav-text">三 扩展状态机系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E5%9B%BE"><span class="nav-text">3.1 状态机系统继承关系图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E4%BD%BF%E7%94%A8%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0%E8%A7%92%E8%89%B2%E5%8A%A8%E7%94%BB"><span class="nav-text">3.2 使用两种方法实现角色动画</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1%E3%80%81%E5%B8%B8%E8%A7%84%E6%96%B9%E6%B3%95-%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="nav-text">3.2.1、常规方法(不使用状态机)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2%E3%80%81%E9%80%9A%E8%BF%87%E7%8A%B6%E6%80%81%E6%9C%BA%E5%AE%9E%E7%8E%B0%E5%8A%A8%E7%94%BB%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2"><span class="nav-text">3.2.2、通过状态机实现动画状态切换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E7%8A%B6%E6%80%81%E6%9C%BA%E6%A8%A1%E5%BC%8F%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-text">3.3 状态机模式优缺点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-text">优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-text">缺点</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E7%BB%A7%E7%BB%AD%E5%AE%8C%E5%96%84%E7%8A%B6%E6%80%81%E6%9C%BA%E5%8A%9F%E8%83%BD"><span class="nav-text">3.4 继续完善状态机功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B-Input-System%E8%BE%93%E5%85%A5%E7%B3%BB%E7%BB%9F"><span class="nav-text">四 Input System输入系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E6%96%B0%E5%BB%BAInput-Actions"><span class="nav-text">4.1 新建Input Actions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1%E3%80%81%E5%88%9B%E5%BB%BA%E7%A7%BB%E5%8A%A8%E5%8A%A8%E4%BD%9C"><span class="nav-text">4.1.1、创建移动动作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2%E3%80%81%E5%88%9B%E5%BB%BA%E8%B7%B3%E8%B7%83%E5%8A%A8%E4%BD%9C"><span class="nav-text">4.1.2、创建跳跃动作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3%E3%80%81%E7%94%9F%E6%88%90c-%E6%96%87%E4%BB%B6"><span class="nav-text">4.1.3、生成c#文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%A9%E5%AE%B6%E8%BE%93%E5%85%A5"><span class="nav-text">4.2 初始化玩家输入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1%E3%80%81%E6%96%B0%E5%BB%BA%E8%84%9A%E6%9C%ACPlayerInput-%E7%8E%A9%E5%AE%B6%E8%BE%93%E5%85%A5%E7%B1%BB%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%B7%BB%E5%8A%A0%E5%88%B0player%E5%AF%B9%E8%B1%A1%E4%B8%AD%E3%80%82"><span class="nav-text">4.2.1、新建脚本PlayerInput 玩家输入类，并且添加到player对象中。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2%E3%80%81%E6%9B%B4%E6%94%B9PlayerState-%E7%8E%A9%E5%AE%B6%E7%8A%B6%E6%80%81%E8%84%9A%E6%9C%AC%EF%BC%8C%E5%8A%A0%E5%85%A5%E7%8E%A9%E5%AE%B6%E8%BE%93%E5%85%A5-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">4.2.2、更改PlayerState 玩家状态脚本，加入玩家输入 初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3%E3%80%81%E4%BF%AE%E6%94%B9PlayerState-Idle%E5%92%8CPlayerState-Run%E8%84%9A%E6%9C%AC"><span class="nav-text">4.2.3、修改PlayerState_Idle和PlayerState_Run脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-4%E3%80%81%E5%9C%A8PlayerStateMachine-%E7%8E%A9%E5%AE%B6%E7%8A%B6%E6%80%81%E6%9C%BA%E7%B1%BB%E4%B8%AD%E5%88%9D%E5%A7%8B%E5%8C%96%E7%8E%A9%E5%AE%B6%E8%BE%93%E5%85%A5"><span class="nav-text">4.2.4、在PlayerStateMachine 玩家状态机类中初始化玩家输入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-5%E3%80%81%E5%9C%A8PlayerController-%E7%8E%A9%E5%AE%B6%E6%8E%A7%E5%88%B6%E5%99%A8%E7%B1%BB%E4%B8%AD%E6%B7%BB%E5%8A%A0%E7%8E%A9%E5%AE%B6%E8%BE%93%E5%85%A5%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%90%AF%E7%94%A8%E5%8A%A8%E4%BD%9C%E8%A1%A8"><span class="nav-text">4.2.5、在PlayerController 玩家控制器类中添加玩家输入，并且启用动作表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94-%E7%8E%A9%E5%AE%B6%E7%A7%BB%E5%8A%A8%E3%80%81%E8%BD%AC%E5%90%91"><span class="nav-text">五 玩家移动、转向</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E7%8E%A9%E5%AE%B6%E7%A7%BB%E5%8A%A8%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-text">5.1 玩家移动功能实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E7%8E%A9%E5%AE%B6%E8%BD%AC%E5%90%91"><span class="nav-text">5.2 玩家转向</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1%E3%80%81%E9%80%9A%E8%BF%87%E9%95%9C%E5%83%8F%E7%BF%BB%E8%BD%AC%E6%94%B9%E5%8F%98%E7%8E%A9%E5%AE%B6%E6%9C%9D%E5%90%91"><span class="nav-text">5.2.1、通过镜像翻转改变玩家朝向</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-2%E3%80%81%E5%81%9C%E6%AD%A2%E7%A7%BB%E5%8A%A8"><span class="nav-text">5.5.2、停止移动</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E7%8E%A9%E5%AE%B6%E5%8A%A0%E9%80%9F%E5%92%8C%E5%87%8F%E9%80%9F"><span class="nav-text">5.3 玩家加速和减速</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1%E3%80%81%E5%AE%9E%E7%8E%B0%E7%8E%A9%E5%AE%B6%E5%8A%A0%E9%80%9F"><span class="nav-text">5.3.1、实现玩家加速</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2%E3%80%81%E5%AE%9E%E7%8E%B0%E7%8E%A9%E5%AE%B6%E5%87%8F%E9%80%9F"><span class="nav-text">5.3.2、实现玩家减速</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-%E7%9B%B8%E6%9C%BA%E8%B7%9F%E9%9A%8F%E7%8E%A9%E5%AE%B6"><span class="nav-text">5.4 相机跟随玩家</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD-%E4%BC%98%E5%8C%96%E6%94%B9%E8%BF%9B%E5%8A%A8%E7%94%BB%E6%92%AD%E6%94%BE"><span class="nav-text">六 优化改进动画播放</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83-%E7%8E%A9%E5%AE%B6%E8%B7%B3%E8%B7%83%E5%8A%9F%E8%83%BD"><span class="nav-text">七 玩家跳跃功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%9C%B0%E9%9D%A2%E6%A3%80%E6%B5%8B"><span class="nav-text">7.1 地面检测</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/Blog/js/utils.js"></script>

<script src="/Blog/js/main.js"></script>

<script src="/Blog/js/header-shrink.js"></script>

<script src="/Blog/js/back2top.js"></script>

<script src="/Blog/js/dark-light-toggle.js"></script>



    
<script src="/Blog/js/local-search.js"></script>




    
<script src="/Blog/js/code-copy.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/Blog/js/left-side-toggle.js"></script>

<script src="/Blog/js/libs/anime.min.js"></script>

<script src="/Blog/js/toc.js"></script>

    
</div>


    
<script src="/Blog/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
